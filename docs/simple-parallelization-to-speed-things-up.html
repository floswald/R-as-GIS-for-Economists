<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5.4 Simple parallelization to speed things up | R as GIS for Economists</title>
  <meta name="description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="5.4 Simple parallelization to speed things up | R as GIS for Economists" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5.4 Simple parallelization to speed things up | R as GIS for Economists" />
  
  <meta name="twitter:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="Taro Mieno" />


<meta name="date" content="2020-06-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="extraction-speed-comparison.html"/>
<link rel="next" href="par-comp.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R as GIS for Economists</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="why-r-as-gis-for-economists.html"><a href="why-r-as-gis-for-economists.html"><i class="fa fa-check"></i>Why R as GIS for Economists?</a><ul>
<li class="chapter" data-level="" data-path="why-r-as-gis-for-economists.html"><a href="why-r-as-gis-for-economists.html#r-vs-python"><i class="fa fa-check"></i>R vs Python</a></li>
<li class="chapter" data-level="" data-path="why-r-as-gis-for-economists.html"><a href="why-r-as-gis-for-economists.html#r-vs-arcgis-or-qgis"><i class="fa fa-check"></i>R vs ArcGIS or QGIS</a></li>
<li class="chapter" data-level="" data-path="why-r-as-gis-for-economists.html"><a href="why-r-as-gis-for-economists.html#summary"><i class="fa fa-check"></i>Summary</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="how-is-this-book-different-from-other-online-books-and-resources.html"><a href="how-is-this-book-different-from-other-online-books-and-resources.html"><i class="fa fa-check"></i>How is this book different from other online books and resources?</a></li>
<li class="chapter" data-level="" data-path="what-is-going-to-be-covered-in-this-book.html"><a href="what-is-going-to-be-covered-in-this-book.html"><i class="fa fa-check"></i>What is going to be covered in this book?</a></li>
<li class="chapter" data-level="" data-path="conventions-of-the-book-and-some-notes.html"><a href="conventions-of-the-book-and-some-notes.html"><i class="fa fa-check"></i>Conventions of the book and some notes</a><ul>
<li class="chapter" data-level="" data-path="conventions-of-the-book-and-some-notes.html"><a href="conventions-of-the-book-and-some-notes.html#texts-in-gray-boxes"><i class="fa fa-check"></i>Texts in gray boxes</a></li>
<li class="chapter" data-level="" data-path="conventions-of-the-book-and-some-notes.html"><a href="conventions-of-the-book-and-some-notes.html#colored-boxes"><i class="fa fa-check"></i>Colored Boxes</a></li>
<li class="chapter" data-level="" data-path="conventions-of-the-book-and-some-notes.html"><a href="conventions-of-the-book-and-some-notes.html#parentheses-around-codes"><i class="fa fa-check"></i>Parentheses around codes</a></li>
<li class="chapter" data-level="" data-path="conventions-of-the-book-and-some-notes.html"><a href="conventions-of-the-book-and-some-notes.html#footnotes"><i class="fa fa-check"></i>Footnotes</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="session-information.html"><a href="session-information.html"><i class="fa fa-check"></i>Session Information</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="demo.html"><a href="demo.html"><i class="fa fa-check"></i><b>1</b> R as GIS: Demonstrations</a><ul>
<li class="chapter" data-level="" data-path="before-you-start.html"><a href="before-you-start.html"><i class="fa fa-check"></i>Before you start</a><ul>
<li class="chapter" data-level="" data-path="before-you-start.html"><a href="before-you-start.html#target-audience"><i class="fa fa-check"></i>Target Audience</a></li>
<li class="chapter" data-level="" data-path="before-you-start.html"><a href="before-you-start.html#direction-for-replication"><i class="fa fa-check"></i>Direction for replication</a></li>
</ul></li>
<li class="chapter" data-level="1.1" data-path="Demo1.html"><a href="Demo1.html"><i class="fa fa-check"></i><b>1.1</b> Demonstration 1: The impact of groundwater pumping on depth to water table</a><ul>
<li class="chapter" data-level="1.1.1" data-path="Demo1.html"><a href="Demo1.html#project-overview"><i class="fa fa-check"></i><b>1.1.1</b> Project Overview</a></li>
<li class="chapter" data-level="1.1.2" data-path="Demo1.html"><a href="Demo1.html#project-demonstration"><i class="fa fa-check"></i><b>1.1.2</b> Project Demonstration</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="demonstration-2-precision-agriculture.html"><a href="demonstration-2-precision-agriculture.html"><i class="fa fa-check"></i><b>1.2</b> Demonstration 2: Precision Agriculture</a><ul>
<li class="chapter" data-level="1.2.1" data-path="demonstration-2-precision-agriculture.html"><a href="demonstration-2-precision-agriculture.html#project-overview-1"><i class="fa fa-check"></i><b>1.2.1</b> Project Overview</a></li>
<li class="chapter" data-level="1.2.2" data-path="demonstration-2-precision-agriculture.html"><a href="demonstration-2-precision-agriculture.html#project-demonstration-1"><i class="fa fa-check"></i><b>1.2.2</b> Project Demonstration</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="demonstration-3-land-use-and-weather.html"><a href="demonstration-3-land-use-and-weather.html"><i class="fa fa-check"></i><b>1.3</b> Demonstration 3: Land Use and Weather</a><ul>
<li class="chapter" data-level="1.3.1" data-path="demonstration-3-land-use-and-weather.html"><a href="demonstration-3-land-use-and-weather.html#project-overview-2"><i class="fa fa-check"></i><b>1.3.1</b> Project Overview</a></li>
<li class="chapter" data-level="1.3.2" data-path="demonstration-3-land-use-and-weather.html"><a href="demonstration-3-land-use-and-weather.html#project-demonstration-2"><i class="fa fa-check"></i><b>1.3.2</b> Project Demonstration</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="demo4.html"><a href="demo4.html"><i class="fa fa-check"></i><b>1.4</b> Demonstration 4: The Impact of Railroad Presence on Corn Planted Acreage</a><ul>
<li class="chapter" data-level="1.4.1" data-path="demo4.html"><a href="demo4.html#project-overview-3"><i class="fa fa-check"></i><b>1.4.1</b> Project Overview</a></li>
<li class="chapter" data-level="1.4.2" data-path="demo4.html"><a href="demo4.html#project-demonstration-3"><i class="fa fa-check"></i><b>1.4.2</b> Project Demonstration</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="demonstration-5-groundwater-use-for-agricultural-irrigation.html"><a href="demonstration-5-groundwater-use-for-agricultural-irrigation.html"><i class="fa fa-check"></i><b>1.5</b> Demonstration 5: Groundwater use for agricultural irrigation</a><ul>
<li class="chapter" data-level="1.5.1" data-path="demonstration-5-groundwater-use-for-agricultural-irrigation.html"><a href="demonstration-5-groundwater-use-for-agricultural-irrigation.html#project-overview-4"><i class="fa fa-check"></i><b>1.5.1</b> Project Overview</a></li>
<li class="chapter" data-level="1.5.2" data-path="demonstration-5-groundwater-use-for-agricultural-irrigation.html"><a href="demonstration-5-groundwater-use-for-agricultural-irrigation.html#project-demonstration-4"><i class="fa fa-check"></i><b>1.5.2</b> Project Demonstration</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="vector-basics.html"><a href="vector-basics.html"><i class="fa fa-check"></i><b>2</b> Handle vector data using the sf package</a><ul>
<li class="chapter" data-level="" data-path="before-you-start-1.html"><a href="before-you-start-1.html"><i class="fa fa-check"></i>Before you start</a><ul>
<li><a href="before-you-start-1.html#sf-or-sp"><code>sf</code> or <code>sp</code>?</a></li>
<li class="chapter" data-level="" data-path="before-you-start-1.html"><a href="before-you-start-1.html#direction-for-replication-1"><i class="fa fa-check"></i>Direction for replication</a></li>
<li class="chapter" data-level="" data-path="before-you-start-1.html"><a href="before-you-start-1.html#packages-to-install-and-load"><i class="fa fa-check"></i>Packages to install and load</a></li>
</ul></li>
<li class="chapter" data-level="2.1" data-path="spatial-data-structure.html"><a href="spatial-data-structure.html"><i class="fa fa-check"></i><b>2.1</b> Spatial Data Structure</a></li>
<li class="chapter" data-level="2.2" data-path="simple-feature-geometry-simple-feature-geometry-list-column-and-simple-feature.html"><a href="simple-feature-geometry-simple-feature-geometry-list-column-and-simple-feature.html"><i class="fa fa-check"></i><b>2.2</b> Simple feature geometry, simple feature geometry list-column, and simple feature</a><ul>
<li class="chapter" data-level="2.2.1" data-path="simple-feature-geometry-simple-feature-geometry-list-column-and-simple-feature.html"><a href="simple-feature-geometry-simple-feature-geometry-list-column-and-simple-feature.html#simple-feature-geometry-sfg"><i class="fa fa-check"></i><b>2.2.1</b> Simple feature geometry (<code>sfg</code>)</a></li>
<li class="chapter" data-level="2.2.2" data-path="simple-feature-geometry-simple-feature-geometry-list-column-and-simple-feature.html"><a href="simple-feature-geometry-simple-feature-geometry-list-column-and-simple-feature.html#create-simple-feature-geometry-list-column-sfc-and-simple-feature-sf-from-scratch"><i class="fa fa-check"></i><b>2.2.2</b> Create simple feature geometry list-column (<code>sfc</code>) and simple feature (<code>sf</code>) from scratch</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="reading-and-writing-vector-data.html"><a href="reading-and-writing-vector-data.html"><i class="fa fa-check"></i><b>2.3</b> Reading and writing vector data</a><ul>
<li class="chapter" data-level="2.3.1" data-path="reading-and-writing-vector-data.html"><a href="reading-and-writing-vector-data.html#reading-a-shapefile"><i class="fa fa-check"></i><b>2.3.1</b> Reading a shapefile</a></li>
<li class="chapter" data-level="2.3.2" data-path="reading-and-writing-vector-data.html"><a href="reading-and-writing-vector-data.html#writing-to-a-shapefile"><i class="fa fa-check"></i><b>2.3.2</b> Writing to a shapefile</a></li>
<li class="chapter" data-level="2.3.3" data-path="reading-and-writing-vector-data.html"><a href="reading-and-writing-vector-data.html#better-alternatives"><i class="fa fa-check"></i><b>2.3.3</b> Better alternatives</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="projection-with-a-different-coordinate-reference-systems.html"><a href="projection-with-a-different-coordinate-reference-systems.html"><i class="fa fa-check"></i><b>2.4</b> Projection with a different Coordinate Reference Systems</a></li>
<li class="chapter" data-level="2.5" data-path="turning-a-data-frame-of-points-into-an-sf.html"><a href="turning-a-data-frame-of-points-into-an-sf.html"><i class="fa fa-check"></i><b>2.5</b> Turning a data.frame of points into an <code>sf</code></a></li>
<li class="chapter" data-level="2.6" data-path="conv-sp.html"><a href="conv-sp.html"><i class="fa fa-check"></i><b>2.6</b> Conversion to and from sp</a></li>
<li class="chapter" data-level="2.7" data-path="non-spatial-transformation-of-sf.html"><a href="non-spatial-transformation-of-sf.html"><i class="fa fa-check"></i><b>2.7</b> Non-spatial transformation of sf</a></li>
<li class="chapter" data-level="2.8" data-path="non-interactive-geometrical-operations.html"><a href="non-interactive-geometrical-operations.html"><i class="fa fa-check"></i><b>2.8</b> Non-interactive geometrical operations</a><ul>
<li class="chapter" data-level="2.8.1" data-path="non-interactive-geometrical-operations.html"><a href="non-interactive-geometrical-operations.html#st_buffer"><i class="fa fa-check"></i><b>2.8.1</b> st_buffer</a></li>
<li class="chapter" data-level="2.8.2" data-path="non-interactive-geometrical-operations.html"><a href="non-interactive-geometrical-operations.html#st_area"><i class="fa fa-check"></i><b>2.8.2</b> st_area</a></li>
<li class="chapter" data-level="2.8.3" data-path="non-interactive-geometrical-operations.html"><a href="non-interactive-geometrical-operations.html#st_centroid"><i class="fa fa-check"></i><b>2.8.3</b> st_centroid</a></li>
<li class="chapter" data-level="2.8.4" data-path="non-interactive-geometrical-operations.html"><a href="non-interactive-geometrical-operations.html#st_length"><i class="fa fa-check"></i><b>2.8.4</b> st_length</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="spatial-interactions-of-vector-data-subsetting-and-joining.html"><a href="spatial-interactions-of-vector-data-subsetting-and-joining.html"><i class="fa fa-check"></i><b>3</b> Spatial Interactions of Vector Data: Subsetting and Joining</a><ul>
<li class="chapter" data-level="" data-path="before-you-start-2.html"><a href="before-you-start-2.html"><i class="fa fa-check"></i>Before you start</a><ul>
<li class="chapter" data-level="" data-path="before-you-start-2.html"><a href="before-you-start-2.html#direction-for-replication-2"><i class="fa fa-check"></i>Direction for replication</a></li>
<li class="chapter" data-level="" data-path="before-you-start-2.html"><a href="before-you-start-2.html#packages-to-install-and-load-1"><i class="fa fa-check"></i>Packages to install and load</a></li>
</ul></li>
<li class="chapter" data-level="3.1" data-path="topological-relations.html"><a href="topological-relations.html"><i class="fa fa-check"></i><b>3.1</b> Topological relations</a><ul>
<li class="chapter" data-level="3.1.1" data-path="topological-relations.html"><a href="topological-relations.html#st_intersects"><i class="fa fa-check"></i><b>3.1.1</b> st_intersects()</a></li>
<li class="chapter" data-level="3.1.2" data-path="topological-relations.html"><a href="topological-relations.html#st_is_within_distance"><i class="fa fa-check"></i><b>3.1.2</b> st_is_within_distance()</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="spatial-subsetting-or-flagging.html"><a href="spatial-subsetting-or-flagging.html"><i class="fa fa-check"></i><b>3.2</b> Spatial Subsetting (or Flagging)</a><ul>
<li class="chapter" data-level="3.2.1" data-path="spatial-subsetting-or-flagging.html"><a href="spatial-subsetting-or-flagging.html#polygons-vs-polygons"><i class="fa fa-check"></i><b>3.2.1</b> polygons vs polygons</a></li>
<li class="chapter" data-level="3.2.2" data-path="spatial-subsetting-or-flagging.html"><a href="spatial-subsetting-or-flagging.html#points-vs-polygons"><i class="fa fa-check"></i><b>3.2.2</b> points vs polygons</a></li>
<li class="chapter" data-level="3.2.3" data-path="spatial-subsetting-or-flagging.html"><a href="spatial-subsetting-or-flagging.html#lines_polygons"><i class="fa fa-check"></i><b>3.2.3</b> lines vs polygons</a></li>
<li class="chapter" data-level="3.2.4" data-path="spatial-subsetting-or-flagging.html"><a href="spatial-subsetting-or-flagging.html#flagging-instead-of-subsetting"><i class="fa fa-check"></i><b>3.2.4</b> Flagging instead of subsetting</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="spatial-join.html"><a href="spatial-join.html"><i class="fa fa-check"></i><b>3.3</b> Spatial Join</a><ul>
<li class="chapter" data-level="3.3.1" data-path="spatial-join.html"><a href="spatial-join.html#case-1-points-target-vs-polygons-source"><i class="fa fa-check"></i><b>3.3.1</b> Case 1: points (target) vs polygons (source)</a></li>
<li class="chapter" data-level="3.3.2" data-path="spatial-join.html"><a href="spatial-join.html#case-2-polygons-target-vs-points-source"><i class="fa fa-check"></i><b>3.3.2</b> Case 2: polygons (target) vs points (source)</a></li>
<li class="chapter" data-level="3.3.3" data-path="spatial-join.html"><a href="spatial-join.html#polygon-polygon"><i class="fa fa-check"></i><b>3.3.3</b> Case 3: polygons (target) vs polygons (source)</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="spatial-intersection-transformative-join.html"><a href="spatial-intersection-transformative-join.html"><i class="fa fa-check"></i><b>3.4</b> Spatial Intersection (transformative join)</a><ul>
<li class="chapter" data-level="3.4.1" data-path="spatial-intersection-transformative-join.html"><a href="spatial-intersection-transformative-join.html#st_intersection"><i class="fa fa-check"></i><b>3.4.1</b> <code>st_intersection()</code></a></li>
<li class="chapter" data-level="3.4.2" data-path="spatial-intersection-transformative-join.html"><a href="spatial-intersection-transformative-join.html#area-weighted-average"><i class="fa fa-check"></i><b>3.4.2</b> Area-weighted average</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="raster-basics.html"><a href="raster-basics.html"><i class="fa fa-check"></i><b>4</b> Raster Data Minimals</a><ul>
<li class="chapter" data-level="" data-path="before-you-start-3.html"><a href="before-you-start-3.html"><i class="fa fa-check"></i>Before you start</a><ul>
<li><a href="before-you-start-3.html#stars-package"><code>stars</code> package</a></li>
</ul></li>
<li class="chapter" data-level="4.1" data-path="raster-data-object-classes.html"><a href="raster-data-object-classes.html"><i class="fa fa-check"></i><b>4.1</b> Raster data object classes</a><ul>
<li class="chapter" data-level="4.1.1" data-path="raster-data-object-classes.html"><a href="raster-data-object-classes.html#raster-package-rasterlayer-rasterstack-and-rasterbrick"><i class="fa fa-check"></i><b>4.1.1</b> <code>raster</code> package: <code>RasterLayer</code>, <code>RasterStack</code>, and <code>RasterBrick</code></a></li>
<li class="chapter" data-level="4.1.2" data-path="raster-data-object-classes.html"><a href="raster-data-object-classes.html#terra-package-spatraster"><i class="fa fa-check"></i><b>4.1.2</b> <code>terra</code> package: <code>SpatRaster</code></a></li>
<li class="chapter" data-level="4.1.3" data-path="raster-data-object-classes.html"><a href="raster-data-object-classes.html#converting-a-spatraster-object-to-a-raster-object."><i class="fa fa-check"></i><b>4.1.3</b> Converting a <code>SpatRaster</code> object to a <code>Raster</code><span class="math inline">\(^*\)</span> object.</a></li>
<li class="chapter" data-level="4.1.4" data-path="raster-data-object-classes.html"><a href="raster-data-object-classes.html#vector-data-in-the-terra-package"><i class="fa fa-check"></i><b>4.1.4</b> Vector data in the <code>terra</code> package</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="read-and-write-a-raster-data-file.html"><a href="read-and-write-a-raster-data-file.html"><i class="fa fa-check"></i><b>4.2</b> Read and write a raster data file</a><ul>
<li class="chapter" data-level="4.2.1" data-path="read-and-write-a-raster-data-file.html"><a href="read-and-write-a-raster-data-file.html#read-raster-files"><i class="fa fa-check"></i><b>4.2.1</b> Read raster file(s)</a></li>
<li class="chapter" data-level="4.2.2" data-path="read-and-write-a-raster-data-file.html"><a href="read-and-write-a-raster-data-file.html#write-raster-files"><i class="fa fa-check"></i><b>4.2.2</b> Write raster files</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="access-values.html"><a href="access-values.html"><i class="fa fa-check"></i><b>4.3</b> Access values</a></li>
<li class="chapter" data-level="4.4" data-path="quick-plotting.html"><a href="quick-plotting.html"><i class="fa fa-check"></i><b>4.4</b> Quick Plotting</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="int-RV.html"><a href="int-RV.html"><i class="fa fa-check"></i><b>5</b> Spatial Interactions of Vector and Raster Data</a><ul>
<li class="chapter" data-level="" data-path="before-you-start-4.html"><a href="before-you-start-4.html"><i class="fa fa-check"></i>Before you start</a><ul>
<li class="chapter" data-level="" data-path="before-you-start-4.html"><a href="before-you-start-4.html#direction-for-replication-3"><i class="fa fa-check"></i>Direction for replication</a></li>
</ul></li>
<li class="chapter" data-level="5.1" data-path="cropping-spatial-subsetting-to-the-area-of-interest.html"><a href="cropping-spatial-subsetting-to-the-area-of-interest.html"><i class="fa fa-check"></i><b>5.1</b> Cropping (Spatial subsetting) to the Area of Interest</a></li>
<li class="chapter" data-level="5.2" data-path="extracting-values-from-raster-layers-for-vector-data.html"><a href="extracting-values-from-raster-layers-for-vector-data.html"><i class="fa fa-check"></i><b>5.2</b> Extracting Values from Raster Layers for Vector Data</a><ul>
<li class="chapter" data-level="5.2.1" data-path="extracting-values-from-raster-layers-for-vector-data.html"><a href="extracting-values-from-raster-layers-for-vector-data.html#points"><i class="fa fa-check"></i><b>5.2.1</b> Points</a></li>
<li class="chapter" data-level="5.2.2" data-path="extracting-values-from-raster-layers-for-vector-data.html"><a href="extracting-values-from-raster-layers-for-vector-data.html#polygons-terra-way"><i class="fa fa-check"></i><b>5.2.2</b> Polygons (<code>terra</code> way)</a></li>
<li class="chapter" data-level="5.2.3" data-path="extracting-values-from-raster-layers-for-vector-data.html"><a href="extracting-values-from-raster-layers-for-vector-data.html#polygons-exactextractr-way"><i class="fa fa-check"></i><b>5.2.3</b> Polygons (<code>exactextractr</code> way)</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="extraction-speed-comparison.html"><a href="extraction-speed-comparison.html"><i class="fa fa-check"></i><b>5.3</b> Extraction speed comparison</a><ul>
<li class="chapter" data-level="5.3.1" data-path="extraction-speed-comparison.html"><a href="extraction-speed-comparison.html#points-terraextract-and-rasterextract"><i class="fa fa-check"></i><b>5.3.1</b> Points: <code>terra::extract()</code> and <code>raster::extract()</code></a></li>
<li class="chapter" data-level="5.3.2" data-path="extraction-speed-comparison.html"><a href="extraction-speed-comparison.html#polygons-exact_extract-terraextract-and-rasterextract"><i class="fa fa-check"></i><b>5.3.2</b> Polygons: <code>exact_extract()</code>, <code>terra::extract()</code>, and <code>raster::extract()</code></a></li>
<li class="chapter" data-level="5.3.3" data-path="extraction-speed-comparison.html"><a href="extraction-speed-comparison.html#single-layer-vs-multi-layer"><i class="fa fa-check"></i><b>5.3.3</b> Single-layer vs multi-layer</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="simple-parallelization-to-speed-things-up.html"><a href="simple-parallelization-to-speed-things-up.html"><i class="fa fa-check"></i><b>5.4</b> Simple parallelization to speed things up</a><ul>
<li class="chapter" data-level="5.4.1" data-path="simple-parallelization-to-speed-things-up.html"><a href="simple-parallelization-to-speed-things-up.html#single-raster-layer"><i class="fa fa-check"></i><b>5.4.1</b> Single raster layer</a></li>
<li class="chapter" data-level="5.4.2" data-path="simple-parallelization-to-speed-things-up.html"><a href="simple-parallelization-to-speed-things-up.html#multiple-raster-layers"><i class="fa fa-check"></i><b>5.4.2</b> Multiple raster layers</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="par-comp.html"><a href="par-comp.html"><i class="fa fa-check"></i><b>A</b> Loop and Parallel Computing</a><ul>
<li class="chapter" data-level="" data-path="before-you-start-5.html"><a href="before-you-start-5.html"><i class="fa fa-check"></i>Before you start</a><ul>
<li class="chapter" data-level="" data-path="before-you-start-5.html"><a href="before-you-start-5.html#direction-for-replication-4"><i class="fa fa-check"></i>Direction for replication</a></li>
<li class="chapter" data-level="" data-path="before-you-start-5.html"><a href="before-you-start-5.html#packages-to-install-and-load-2"><i class="fa fa-check"></i>Packages to install and load</a></li>
</ul></li>
<li class="chapter" data-level="A.1" data-path="repetitive-processes-and-looping.html"><a href="repetitive-processes-and-looping.html"><i class="fa fa-check"></i><b>A.1</b> Repetitive processes and looping</a><ul>
<li class="chapter" data-level="A.1.1" data-path="repetitive-processes-and-looping.html"><a href="repetitive-processes-and-looping.html#what-is-looping"><i class="fa fa-check"></i><b>A.1.1</b> What is looping?</a></li>
<li class="chapter" data-level="A.1.2" data-path="repetitive-processes-and-looping.html"><a href="repetitive-processes-and-looping.html#for-loop"><i class="fa fa-check"></i><b>A.1.2</b> For loop</a></li>
<li class="chapter" data-level="A.1.3" data-path="repetitive-processes-and-looping.html"><a href="repetitive-processes-and-looping.html#for-loop-using-the-lapply-function"><i class="fa fa-check"></i><b>A.1.3</b> For loop using the <code>lapply()</code> function</a></li>
<li class="chapter" data-level="A.1.4" data-path="repetitive-processes-and-looping.html"><a href="repetitive-processes-and-looping.html#looping-over-multiple-variables-using-lapply"><i class="fa fa-check"></i><b>A.1.4</b> Looping over multiple variables using lapply()</a></li>
<li class="chapter" data-level="A.1.5" data-path="repetitive-processes-and-looping.html"><a href="repetitive-processes-and-looping.html#do-you-really-need-to-loop"><i class="fa fa-check"></i><b>A.1.5</b> Do you really need to loop?</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="parcomp.html"><a href="parcomp.html"><i class="fa fa-check"></i><b>A.2</b> Parallelization of embarrassingly parallel processes</a><ul>
<li class="chapter" data-level="A.2.1" data-path="parcomp.html"><a href="parcomp.html#mac-or-linux-users"><i class="fa fa-check"></i><b>A.2.1</b> Mac or Linux users</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R as GIS for Economists</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<link href="style.css" rel="stylesheet" type="text/css">

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-59758608-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-59758608-3');
</script>
<div id="simple-parallelization-to-speed-things-up" class="section level2">
<h2><span class="header-section-number">5.4</span> Simple parallelization to speed things up</h2>
<p>Here we will explore ways to speed up raster data extraction using parallelized processing, which is useful particularly when you are processing many large raster files. We start with data extraction from a single raster layer and then move on to data extraction from multiple raster layers. Those who are not familiar with looping using <code>lapply()</code> and parallelization using <code>mclapply()</code> (Mac and Linux users only) or <code>future_lapply()</code> (including Windows), see Chapter <a href="par-comp.html#par-comp">A</a> first.</p>
<p>Let’s prepare for parallel processing for the rest of the section.</p>
<div class="sourceCode" id="cb387"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb387-1" data-line-number="1"><span class="kw">library</span>(RhpcBLASctl)</a>
<a class="sourceLine" id="cb387-2" data-line-number="2"><span class="kw">library</span>(parallel)</a>
<a class="sourceLine" id="cb387-3" data-line-number="3"></a>
<a class="sourceLine" id="cb387-4" data-line-number="4"><span class="co">#--- number of cores to use ---#</span></a>
<a class="sourceLine" id="cb387-5" data-line-number="5">(</a>
<a class="sourceLine" id="cb387-6" data-line-number="6">num_cores &lt;-<span class="st"> </span><span class="kw">get_num_procs</span>() <span class="op">-</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb387-7" data-line-number="7">)</a></code></pre></div>
<pre><code>[1] 15</code></pre>
<div id="single-raster-layer" class="section level3">
<h3><span class="header-section-number">5.4.1</span> Single raster layer</h3>
<p>We will use the following datasets:</p>
<ul>
<li>raster: Iowa Cropland Data Layer (CDL) data in 2015<br />
</li>
<li>polygons: Regular polygon grids over Iowa</li>
</ul>
<p><strong>Iowa CDL data in 2015</strong></p>
<div class="sourceCode" id="cb389"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb389-1" data-line-number="1"><span class="co">#--- Iowa CDL in 2015 ---#</span></a>
<a class="sourceLine" id="cb389-2" data-line-number="2">(</a>
<a class="sourceLine" id="cb389-3" data-line-number="3">IA_cdl_<span class="dv">15</span> &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="st">&quot;./Data/IA_cdl_2015_ag_2.tif&quot;</span>)</a>
<a class="sourceLine" id="cb389-4" data-line-number="4">)</a></code></pre></div>
<pre><code>class      : RasterLayer 
dimensions : 5836, 8898, 51928728  (nrow, ncol, ncell)
resolution : 60, 60  (x, y)
extent     : -52095, 481785, 1938135, 2288295  (xmin, xmax, ymin, ymax)
crs        : +proj=aea +lat_1=29.5 +lat_2=45.5 +lat_0=23 +lon_0=-96 +x_0=0 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs 
source     : /Users/tmieno2/Dropbox/TeachingUNL/RGIS_Econ/Data/IA_cdl_2015_ag_2.tif 
names      : IA_cdl_2015_ag_2 
values     : 0, 255  (min, max)</code></pre>
<p>Values recorded in the raster data are integers representing land use type.</p>
<p><strong>Regularly-sized grids over Iowa</strong></p>
<div class="sourceCode" id="cb391"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb391-1" data-line-number="1"><span class="co">#--- regular grids over Iowa ---#</span></a>
<a class="sourceLine" id="cb391-2" data-line-number="2">(</a>
<a class="sourceLine" id="cb391-3" data-line-number="3">IA_grids &lt;-<span class="st"> </span><span class="kw">st_as_sf</span>(<span class="kw">map</span>(<span class="st">&quot;state&quot;</span>, <span class="st">&quot;iowa&quot;</span>, <span class="dt">plot =</span> <span class="ot">FALSE</span>, <span class="dt">fill =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb391-4" data-line-number="4"><span class="st">  </span><span class="co">#--- create regularly-sized grids ---#</span></a>
<a class="sourceLine" id="cb391-5" data-line-number="5"><span class="st">  </span><span class="kw">st_make_grid</span>(<span class="dt">n =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">50</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb391-6" data-line-number="6"><span class="st">  </span><span class="co">#--- project to the CRS of the CDL data ---#</span></a>
<a class="sourceLine" id="cb391-7" data-line-number="7"><span class="st">  </span><span class="kw">st_transform</span>(<span class="kw">projection</span>(IA_cdl_<span class="dv">15</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb391-8" data-line-number="8"><span class="st">  </span><span class="co">#--- convert to sf from sfc  ---#</span></a>
<a class="sourceLine" id="cb391-9" data-line-number="9"><span class="st">  </span><span class="kw">st_as_sf</span>()</a>
<a class="sourceLine" id="cb391-10" data-line-number="10">)</a></code></pre></div>
<pre><code>Simple feature collection with 2035 features and 0 fields
geometry type:  POLYGON
dimension:      XY
bbox:           xmin: -49480.27 ymin: 1937867 xmax: 483649.6 ymax: 2289564
CRS:            +proj=aea +lat_1=29.5 +lat_2=45.5 +lat_0=23 +lon_0=-96 +x_0=0 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs
First 10 features:
                                x
1  POLYGON ((373548.7 1937867,...
2  POLYGON ((384427.1 1938383,...
3  POLYGON ((362351.4 1944380,...
4  POLYGON ((373220.9 1944881,...
5  POLYGON ((384089.6 1945396,...
6  POLYGON ((362033.1 1951394,...
7  POLYGON ((372893 1951894, 3...
8  POLYGON ((383752.2 1952409,...
9  POLYGON ((14258.36 1950217,...
10 POLYGON ((25120.22 1950244,...</code></pre>
<p>Here is how they look (Figure <a href="simple-parallelization-to-speed-things-up.html#fig:land-grids">5.5</a>):</p>
<div class="sourceCode" id="cb393"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb393-1" data-line-number="1"><span class="kw">tm_shape</span>(IA_cdl_<span class="dv">15</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb393-2" data-line-number="2"><span class="st">  </span><span class="kw">tm_raster</span>(<span class="dt">title =</span> <span class="st">&quot;Land Use &quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb393-3" data-line-number="3"><span class="kw">tm_shape</span>(IA_grids) <span class="op">+</span></a>
<a class="sourceLine" id="cb393-4" data-line-number="4"><span class="st">  </span><span class="kw">tm_polygons</span>(<span class="dt">alpha =</span> <span class="dv">0</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb393-5" data-line-number="5"><span class="kw">tm_layout</span>(<span class="dt">legend.outside =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<div class="figure"><span id="fig:land-grids"></span>
<img src="SpatialInteractionVectorRaster_files/figure-html/land-grids-1.png" alt="Regularly-sized grids and land use type in Iowa in 2105" width="672" />
<p class="caption">
Figure 5.5: Regularly-sized grids and land use type in Iowa in 2105
</p>
</div>
<hr />
<p>Here is how long it takes to extract raster data values for the polygon grids using <code>exact_extract()</code>.</p>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb394-1" data-line-number="1"><span class="kw">tic</span>()</a>
<a class="sourceLine" id="cb394-2" data-line-number="2">temp &lt;-<span class="st"> </span><span class="kw">exact_extract</span>(IA_cdl_<span class="dv">15</span>, IA_grids)</a>
<a class="sourceLine" id="cb394-3" data-line-number="3"><span class="kw">toc</span>()</a></code></pre></div>
<pre><code>elapsed 
  9.515 </code></pre>
<p>One way to parallelize this process is to let each core work on one polygon at a time. Let’s first define the function to extract values for one polygon and then run it parallelized.</p>
<div class="sourceCode" id="cb396"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb396-1" data-line-number="1"><span class="co">#--- function to extract raster values for a single polygon ---#</span></a>
<a class="sourceLine" id="cb396-2" data-line-number="2">get_values_i &lt;-<span class="st"> </span><span class="cf">function</span>(i){</a>
<a class="sourceLine" id="cb396-3" data-line-number="3"></a>
<a class="sourceLine" id="cb396-4" data-line-number="4">  temp &lt;-<span class="st"> </span><span class="kw">exact_extract</span>(IA_cdl_<span class="dv">15</span>, IA_grids[i, ])</a>
<a class="sourceLine" id="cb396-5" data-line-number="5"></a>
<a class="sourceLine" id="cb396-6" data-line-number="6">  <span class="kw">return</span>(temp)</a>
<a class="sourceLine" id="cb396-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb396-8" data-line-number="8"></a>
<a class="sourceLine" id="cb396-9" data-line-number="9"><span class="co">#--- parallelized ---#</span></a>
<a class="sourceLine" id="cb396-10" data-line-number="10"><span class="kw">tic</span>()</a>
<a class="sourceLine" id="cb396-11" data-line-number="11">tmep &lt;-<span class="st"> </span><span class="kw">mclapply</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(IA_grids), get_values_i, <span class="dt">mc.cores =</span> num_cores)</a>
<a class="sourceLine" id="cb396-12" data-line-number="12"><span class="kw">toc</span>()</a></code></pre></div>
<pre><code>99.426 sec elapsed</code></pre>
<p>As you can see, this is a terrible way to parallelize the computation process. To see why, let’s look at the computation time of extracting from one, two, and three polygons.</p>
<div class="sourceCode" id="cb398"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb398-1" data-line-number="1"><span class="kw">library</span>(microbenchmark)</a>
<a class="sourceLine" id="cb398-2" data-line-number="2">mb &lt;-<span class="st"> </span><span class="kw">microbenchmark</span>(</a>
<a class="sourceLine" id="cb398-3" data-line-number="3">  <span class="st">&quot;p_1&quot;</span> =<span class="st"> </span>{</a>
<a class="sourceLine" id="cb398-4" data-line-number="4">    temp &lt;-<span class="st"> </span><span class="kw">exact_extract</span>(IA_cdl_<span class="dv">15</span>, IA_grids[<span class="dv">1</span>, ])</a>
<a class="sourceLine" id="cb398-5" data-line-number="5">  },</a>
<a class="sourceLine" id="cb398-6" data-line-number="6">  <span class="st">&quot;p_2&quot;</span> =<span class="st"> </span>{</a>
<a class="sourceLine" id="cb398-7" data-line-number="7">    temp &lt;-<span class="st"> </span><span class="kw">exact_extract</span>(IA_cdl_<span class="dv">15</span>, IA_grids[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, ])</a>
<a class="sourceLine" id="cb398-8" data-line-number="8">  },</a>
<a class="sourceLine" id="cb398-9" data-line-number="9">  <span class="st">&quot;p_3&quot;</span> =<span class="st"> </span>{</a>
<a class="sourceLine" id="cb398-10" data-line-number="10">    temp &lt;-<span class="st"> </span><span class="kw">exact_extract</span>(IA_cdl_<span class="dv">15</span>, IA_grids[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, ])</a>
<a class="sourceLine" id="cb398-11" data-line-number="11">  },</a>
<a class="sourceLine" id="cb398-12" data-line-number="12">  <span class="st">&quot;p_4&quot;</span> =<span class="st"> </span>{</a>
<a class="sourceLine" id="cb398-13" data-line-number="13">    temp &lt;-<span class="st"> </span><span class="kw">exact_extract</span>(IA_cdl_<span class="dv">15</span>, IA_grids[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, ])</a>
<a class="sourceLine" id="cb398-14" data-line-number="14">  },</a>
<a class="sourceLine" id="cb398-15" data-line-number="15">  <span class="st">&quot;p_5&quot;</span> =<span class="st"> </span>{</a>
<a class="sourceLine" id="cb398-16" data-line-number="16">    temp &lt;-<span class="st"> </span><span class="kw">exact_extract</span>(IA_cdl_<span class="dv">15</span>, IA_grids[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, ])</a>
<a class="sourceLine" id="cb398-17" data-line-number="17">  },</a>
<a class="sourceLine" id="cb398-18" data-line-number="18">  <span class="dt">times =</span> <span class="dv">100</span></a>
<a class="sourceLine" id="cb398-19" data-line-number="19">)</a></code></pre></div>
<div class="sourceCode" id="cb399"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb399-1" data-line-number="1">mb <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">data.table</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb399-2" data-line-number="2"><span class="st">  </span>.[, expr <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;p_&quot;</span>, <span class="st">&quot;&quot;</span>, expr)] <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb399-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>(.) <span class="op">+</span></a>
<a class="sourceLine" id="cb399-4" data-line-number="4"><span class="st">    </span><span class="kw">geom_boxplot</span>(<span class="kw">aes</span>(<span class="dt">y =</span> time<span class="op">/</span><span class="fl">1e9</span>, <span class="dt">x =</span> expr)) <span class="op">+</span></a>
<a class="sourceLine" id="cb399-5" data-line-number="5"><span class="st">    </span><span class="kw">ylim</span>(<span class="dv">0</span>, <span class="ot">NA</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb399-6" data-line-number="6"><span class="st">    </span><span class="kw">ylab</span>(<span class="st">&quot;seconds&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb399-7" data-line-number="7"><span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;number of polygons to process&quot;</span>)</a></code></pre></div>
<div class="figure"><span id="fig:comp-polygons"></span>
<img src="SpatialInteractionVectorRaster_files/figure-html/comp-polygons-1.png" alt="Comparison of the computation time of raster data extractions" width="672" />
<p class="caption">
Figure 5.6: Comparison of the computation time of raster data extractions
</p>
</div>
<p>As you can see in Figure <a href="simple-parallelization-to-speed-things-up.html#fig:comp-polygons">5.6</a>, there is a significant overhead (about 0.2 seconds) irrespective of the number of the polygons to extract data for. Once the process is initiated and ready to start extract values for polygons, it does not spend much time in processing for additional unit of polygon. This is a typical example where you do NOT want to parallelize. Since each core processes <span class="math inline">\(136\)</span> polygons, a very simple math suggests that you would spend at least 27.2 (0.2 <span class="math inline">\(\times\)</span> 136) seconds.</p>
<p>We can minimize this overhead as much as possible by having each core use <code>exact_extract()</code> only once to process for multiple polygons. Specifically, we will split the collection of the polygons into 15 groups and have each core address one group.</p>
<div class="sourceCode" id="cb400"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb400-1" data-line-number="1"><span class="kw">tic</span>()</a>
<a class="sourceLine" id="cb400-2" data-line-number="2"><span class="co">#--- number of polygons in a group ---#</span></a>
<a class="sourceLine" id="cb400-3" data-line-number="3">num_in_group &lt;-<span class="st"> </span><span class="kw">floor</span>(<span class="kw">nrow</span>(IA_grids)<span class="op">/</span>num_cores)</a>
<a class="sourceLine" id="cb400-4" data-line-number="4"></a>
<a class="sourceLine" id="cb400-5" data-line-number="5"><span class="co">#--- define group id ---#</span></a>
<a class="sourceLine" id="cb400-6" data-line-number="6">IA_grids &lt;-<span class="st"> </span>IA_grids <span class="op">%&gt;%</span><span class="st">  </span></a>
<a class="sourceLine" id="cb400-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb400-8" data-line-number="8">    <span class="co">#--- create grid id ---#</span></a>
<a class="sourceLine" id="cb400-9" data-line-number="9">    <span class="dt">grid_id =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(.),</a>
<a class="sourceLine" id="cb400-10" data-line-number="10">    <span class="co">#--- assign group id  ---#</span></a>
<a class="sourceLine" id="cb400-11" data-line-number="11">    <span class="dt">group_id =</span> grid_id <span class="op">%/%</span><span class="st"> </span>num_in_group <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb400-12" data-line-number="12">  )</a>
<a class="sourceLine" id="cb400-13" data-line-number="13"></a>
<a class="sourceLine" id="cb400-14" data-line-number="14"><span class="co">#--- parallelized processing by group ---#</span></a>
<a class="sourceLine" id="cb400-15" data-line-number="15">temp &lt;-<span class="st"> </span><span class="kw">mclapply</span>(</a>
<a class="sourceLine" id="cb400-16" data-line-number="16">  <span class="dv">1</span><span class="op">:</span>num_cores, </a>
<a class="sourceLine" id="cb400-17" data-line-number="17">  <span class="cf">function</span>(i) <span class="kw">exact_extract</span>(IA_cdl_<span class="dv">15</span>, <span class="kw">filter</span>(IA_grids, group_id <span class="op">==</span><span class="st"> </span>i)),</a>
<a class="sourceLine" id="cb400-18" data-line-number="18">  <span class="dt">mc.cores =</span> num_cores</a>
<a class="sourceLine" id="cb400-19" data-line-number="19">) </a>
<a class="sourceLine" id="cb400-20" data-line-number="20"><span class="kw">toc</span>()</a></code></pre></div>
<pre><code>elapsed 
   5.63 </code></pre>
<p>As you can see, the computation time is now much less, but it is still only 3.89 seconds that you gained. How much time did I spend <strong>writing</strong> the code to do the parallelized group processing? Two minutes. Obviously, what matters to you is the <strong>total</strong> time (coding time plus processing time) you spend to get the desired outcome. Indeed, the time you could save by a clever coding at the most is 9.52. Writing any kind of code in an attempt to make your code faster takes more than that. So, don’t even try to make your code faster if the processing time is quite short in the first place. Before you start parallelizing things, go through what you need to go through in terms of coding in your head, and judge if it’s worth it or not. If the non-parallelized original process takes 30 minutes and you potentially need to repeat the process multiple times? Sure.</p>
</div>
<div id="multiple-raster-layers" class="section level3">
<h3><span class="header-section-number">5.4.2</span> Multiple raster layers</h3>

</div>
</div>
<!-- </div> -->



            </section>

          </div>
        </div>
      </div>
<a href="extraction-speed-comparison.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="par-comp.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
